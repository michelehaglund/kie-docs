[id='_defining_business_rules']
= Defining the Driver License Suspension Rule

The following chapter instructs you how to create a driver license suspension rule and a speed violation decision table in {PRODUCT} using:

* The Guided Rule wizard
* The Guided Decision Table wizard

[float]
== Prerequisite

Created both the Violation and Driver data objects.

== Creating a driver license suspension rule

*<MH> Ivo, is there a logical break point in this section? It contains 35 steps. Not user friendly. Additionally, I will be adding more step-specific screen captures to assist the readers.</MH>*

 . Log in to Business Central. Click *Menu* -> *Design* -> *Projects*, then *Driver department traffic violations*.
 . Click *Create New Asset* -> *Guided Rule*, then enter:

 * *Guided Rule*: `DriverLicenseSuspensionRule`
 * *Package*: `org.jboss.example.traffic_violations`
+

. Click *Ok* to open the Guided Rule Editor.
. Click image:6176.png[] next to the *WHEN* label to open the *Add a condition to the rule* window. . . Select *Driver...* and click *Ok*.
. Click the *There is a Driver* label to open the *Modify contraints for Driver* window.
. Enter `driver` in the *Variable name* field and click *Set*.
. Click the *There is a Driver[driver]* label to open the *Modify contraints for Driver* window.
. Click *Expression editor* -> *[not bound]* to open the *Expression editor*.
. In the *Bind the Expression to a new variable* field, enter: `previousPts` and click *Set*.
. From the *Choose...* menu, select *totalPoints*.
. Click image:6176.png[] next to line 1 (the *previousPts* label) to open the *Add a condition to the rule* window.
. Select *From Accumulate...* and click *Ok*.
. Select *click to add pattern...* above the *From Accumulate* label and select *Number* from the *choose fact type* pull-down menu.
. Click *There is a number* label to open the *Modify contraints for Driver* window.
. Click *Expression editor* and select *intValue()* from the
*[not bound]:* *Choose...* menu.
. Click *[not bound]* to open the *Expression editor*.
. In the *Bind the Expression to a new variable* field, enter: `totalNewPoints` and click *Set*.
. Select *click to add pattern* below the *From Accumulate...* label and select *Violation* from the *choose fact type* pull-down menu.
. Click *All Violations with:* to open the *Modify contraints for Violation* window and select *points* from the *Add a restriction on a field* pull-down menu.
. Click *--- please choose ---* next to the *points* label and select *greater than*.
. Click image:6191.png[], then click *Literal value*.
. Click the *points* label to open the *Add a field* window and input `vPoints` and click *Set*.
. In the *Function* field, enter `sum(vPoints)`.
. Click image:6176.png[] next to line 2 (the *vPoints* label) to open the *Add a condition to the rule* window.
. Select *Free from DRL* and click *Ok*.
. Enter the following in the _Add free form DRL..._ text box (line 3):
+
----
eval((previousPts+totalNewPoints)>=20)
----
. Click image:6176.png[] next to the *(show options...)* label and select *Change field values of driver...*, then click *Ok*.
. Click the *Set value of Driver [driver]* field and select *state* from the *Add field* pull-down menu.
. Click image:6191.png[] next to *state* in the *Set value of Driver [driver]* section to open the *Field value* window.
. Click *Literal value* and input `suspend` in the new field.
. Click *(show options...)* and then click image:6176.png[] next to the *Attributes* label.
. From the *Add an option to the rule* window, select the *ruleflow-group* option from the *Attribute* pull-down menu.
. Enter `trafficViolation` in to the *ruleflow-group* field.
. Click *Save*, then click *Save* to confirm your changes.
+
image::rulepanel.png[]

== Creating a speed violation decision table

*<MH> Ivo, is there a logical break point in this section? Not user friendly. Additionally, I will be adding more step-specific screen captures to assist the readers.</MH>*

. Log in to {CENTRAL}. Click *Menu* -> *Design* -> *Projects*, then *Driver department traffic violations*.
. Click *Create New Asset* -> *Guided Decision Table*.
. Enter `SpeedViolationRule` in the *Guided Decision Table* field and click *+OK*.
. Click *Columns* -> *Insert Column* and select *Include advanced options*.
. Select *Add an Attribute column* and click *Next*.
. Select *Ruleflow-group* and click *Finish*.
. Expand *Attribute columns* and enter `trafficViolation` in the *Default value* field.
. Click *Insert Column*, select *Add a Condition* -> *Pattern* -> *Create a new Fact Pattern*.
. Select *Violation* from the *Fact type* pull-down menu, enter `v` in the *Binding* field, and click *+OK*.
. Select *Calculation type* -> *Literal value*.
. Select *Field* and then *type* from the *Field* pull-down menu.
. Select *Operator* and then *equal to* from the *Operator* pull-down menu.
. Select *Value options* and enter `Driving while intoxicated,DWI=Driving while under the influence of drugs` in the *Value list (optional)* field.
. Select *Additional info*, enter `Violation Type` in the *Header (description)* field, and click *Finish*.
. Click *Insert Column*, select *Add a Condition* -> *Pattern* and select *Violation[v]* from the *Pattern* pull-down menu.
. Select *Calculation type* -> *Predicate* -> *Field* and enter `actualSpeed-speedLimit > $param`.
. Select *Value options*, then select *Additional info* and enter `Speed Limit (MPH) >` in the *Header (description)* field.
. Click *Finish*.
. Click *Insert Column*, select *Add a Condition* -> *Pattern* and select *Violation[v]* from the *Pattern* pull-down menu.
. Select *Calculation type* -> *Predicate*.
. Select *Field* and enter `actualSpeed-speedLimit < $param` in the *Field* field.
. Select *Operator*, select *Value options*, then select *Additional info*.
. Enter `Speed Limit (MPH) <` in the *Header (description)* field and click *Finish*.
. Click *Insert Column*, select *Set the value of a field* -> *Pattern* and select *Violation[v]* from the *Pattern* pull-down menu.
. Select *Field* and then *fineAmount* from the *Field* pull-down menu.
. Select *Value options*, then select *Additional info* and enter `Fine Amount` in the *Header (description)* field.
. Select the *Update engine with changes* option and click *Finish*.
. Click *Insert Column*, select *Set the value of a field* -> *Pattern* and select *Violation[v]* from the *Pattern* pull-down menu.
. Select *Field* and then *points* from the *Field* pull-down menu.
. Select *Value options*, then select *Additional info* and enter `Points` in the *Header (description)* field.
. Select the *Update engine with changes* option and click *Finish*.
. Click *Columns*, expand *Attribute columns*, and select the *Hide column* option.
. Click *Editor* -> *Insert* -> *Append row*. Repeat this step to add a total of four table rows.
. Fill out the table as shown in the following example *<MH> Replace with a proper screen capture from my UI test</MH>*:
+
image:guided-dt.png[]

. Click *Save*, then click *Save* to confirm your changes.
