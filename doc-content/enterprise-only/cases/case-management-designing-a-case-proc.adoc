[id='case-management-designing-a-case-proc']
= Designing a case

Cases are designed using the process designer in {CENTRAL}. The case design is the basis of case management and sets out the specific goals and tasks for each case. The case flow can be modified dynamically during run time by adding dynamic tasks or processes.

To demonstrate how to design a case, {PRODUCT} includes the IT Orders sample project in {CENTRAL}, which includes the following *orderhardware* business process case definition:

.orderhardware business process case definition
image::cases/itorders-orderhardware-process.png[IT Orders case design]

.Prerequisite
You have followed the procedure in <<case-management-creating-a-case-proc>> to create a new case in {CENTRAL}.

.Procedure
. In {CENTRAL}, go to *Menu* -> *Design* -> *Projects* and click *IT_Orders_New*.
. Click *Add Asset* -> *Case Definition*.
. In the *Create new Case definition* window, add the following required information:
+
* *Case Definition*: Input `orderhardware`. This is usually the subject of the case or project that is being case managed.
* *Package*: Select *com.myspace.it_orders_new* to specify the location that the case file is created in.
//* `Case ID prefix (optional)`: A configurable prefix that enables you to easily distinguish different types of cases. The prefix is followed by a generated ID in the format `ID-XXXXXXXXXX`, where `XXXXXXXXXX` is a generated number that provides a unique ID for the case instance. If a prefix is not provided, the default prefix is `CASE` and generates instances with the following identifiers:
//+
//`CASE-0000000001`
//+
//`CASE-0000000002`
//+
//`CASE-0000000003`
//+
//If a prefix is set to something else, such as `IT` for example, the following identifiers are generated:
//+
//`IT-0000000001`
//+
//`IT-0000000002`
//+
//`IT-0000000003`

+
. Click *Ok* to open the process designer.
. Define process-level and case-level variables.
.. Click image:cases/expand-proj-explorer.png[] to view the *Project Explorer*.
.. Click *BUSINESS PROCESSES* -> *orderhardware*.
.. Click image:cases/case-prop-editor.png[] on the right side of the designer to open the *Diagram properties* panel.
.. Expand *Process Data* and click image:cases/plus-sign.png[] next to *Process Variables*.
.. Input the following values:
+
.IT Orders variables
image::cases/process-vars.png[Editor for IT Orders variables]
+

. Define the roles involved in the case.
.. Expand *Case Management* and click image:cases/plus-sign.png[] next to *Case Roles*.
.. Input the following values:
+

.ITOrders Case Roles
image::cases/case_roles-2.png[Case Roles]

+
* `owner`: The employee who is making the hardware order request. The role cardinality is set to `1`, which means that only one person or group can be assigned to this role.
* `manager`: The employee's manager; the person who will approve or deny the requested hardware. The role cardinality is set to `1`, which means that only one person or group can be assigned to this role.
* `supplier`: The available suppliers of IT hardware in the system. The role cardinality is set to `2`, which means that more than one supplier can be assigned to this role.

+

For more information about creating case roles, see
ifeval::["{context}" == "case-management-getting-started"]
<<case-management-roles-con-case-management-getting-started>>
endif::[]
ifeval::["{context}" == "case-management-design"]
<<case-management-roles-con-case-management-design>>
endif::[]
.

. Create the place-order subprocess, which is a separate business process that is carried out by the supplier. This is a reusable process that occurs during the course of case execution.
.. From the project menu, click *Add Asset* -> *Business Process*.
.. In the *Create new Business Process* wizard, enter the following values:
* *Business Process*: `place-order`
* *Package*: Select `com.myspace.it_orders_new`
.. Click *Ok*. The diagram editor opens.
.. Click on an empty space in then canvas, and in the upper-right corner, click the *Diagram properties* image:getting-started/diagram_properties.png[] icon.
.. Scroll down and expand *Process Data* and click image:getting-started/btn_plus.png[] in the *Process Variables* section and enter the following values:
+
* *Name*: `CaseId`.
* *Data Type*: `String`
.. Click image:getting-started/btn_plus.png[] to add a another variable:
+
* *Name*: `Requestor`.
* *Data Type*: `String`
.. Click on the start event and create an outgoing connection from the start event to a task and convert the new task to a user task.
+
image::cases/user-task.png[]
.. Click the user task and in the *Diagram Properties* panel, input `Place order` in the *Name* field.
.. Create an outgoing connection from the *Place order* user task and connect it to an end event.
+
image::cases/create-end-event.png[]
+
image::cases/end-event.png[]
.. In the diagram editor, click *Save*, then *Save*, to confirm your changes.

. Define the work item to be triggered when a new case starts.
+
NOTE: Because case definition is an ad hoc process definition, it does not require an explicit start node. Nodes that have no incoming connections are marked as `Adhoc Autostart` and are automatically triggered when a new case instance is started.
+
By default, the process designer includes a `Milestone` object configured as `Adhoc autostart`.

. Click *Add Asset* -> *Business Process (legacy)*.
. Enter the following values:
+
* *Business Process*: `orderhardware`
* *Package*: Select `com.myspace.it_orders_new`

. Click *Ok*. The diagram editor opens.
. In the upper-right corner, click the *Diagram properties* image:getting-started/diagram_properties.png[] icon.


.. Create an evaluation condition for the milestone based on a case file variable that determines when the milestone is completed. From the *Properties* menu on the right, open the *Data Inputs and Assignments* window and click *Add* to add a new condition.
+
In the IT Orders case, the status of `Milestone 1: Order placed` depends on the condition `org.kie.api.runtime.process.CaseData(data.get("ordered") == true)`. This means that a case variable named `ordered` exists with the value `true`, and it is configured on the milestone in the following way:
+
image::cases/milestone-evaluation-condition.png[Milestone evaluation condition configuration]
+
For more information about the milestones in the IT Orders case, see
ifeval::["{context}" == "case-management-getting-started"]
<<case-management-itorders-milestones-ref-case-management-getting-started>>.
endif::[]
ifeval::["{context}" == "case-management-design"]
{URL_GETTING_STARTED_CASES}[_{GETTING_STARTED_CASES}_].
endif::[]
+
To learn more about milestones, see <<case-management-milestones-con-{context}>>.

The IT Orders case can be closed after all milestone sequences are completed. However, due to the ad hoc nature of cases, the case could be reopened if, for example, the order was never received by the customer or the item is faulty. Tasks can be re-triggered or added to the case definition as required, even during run time.

For more information about ad hoc processes, see <<case-management-adhoc-con-{context}>>.
